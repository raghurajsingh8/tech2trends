(()=>{let e=(e,t)=>{let i=()=>{var i,a;return null==e||null==(a=e.renderingWeblabs)||null==(i=a[t])?void 0:i.toLowerCase()};return{isT1:()=>"t1"===i(),isT2:()=>"t2"===i(),getTreatment:()=>i()}},t=()=>e(window,"ADPT_SF_LOW_RATE_METRIC_LOGGING_1256362"),i=()=>e(window,"ADPT_SF_HIGH_RATE_METRIC_LOGGING_1256364"),a=()=>e(window,"APM_STORES_JPS_JRS_SAFEFRAME_OBSTRUCTIONS_1237329"),n=()=>e(window,"APM_STORES_JPS_JRS_SAFEFRAME_H1_SAFEZONE_1279523"),r=()=>e(window,"APM_STORES_JPS_JRS_SAFEFRAME_DEPRECATE_CHANGESIZE_1282516"),s=()=>e(window,"ADPT_SF_SERVER_SIDE_SPONSORED_LABEL_998980"),l=()=>e(window,"APM_STORES_JPS_JRS_SAFEFRAME_CREATIVE_SIZE_STYLE_1290868"),o=()=>e(window,"APM_STORES_JPS_JRS_SAFEFRAME_VIEW_RATE_EXPERIMENT_1289633"),d=()=>e(window,"APM_STORES_JPS_JRS_CREATIVE_BOOKS_ADS_1277965"),c=()=>e(window,"APM_STORES_JPS_JRS_SAFEFRAME_DEPRECATE_AMZN_GROUPM_1309333"),m=(e,t,i)=>(...a)=>{try{e(...a)}catch(e){null==t||t(i||"Error in handler",e)}},h=e=>"V"===e,u=e=>b(e),p=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/,g=e=>p.test(e),v=e=>g(e)?u(e):e,w=e=>g(e)?e:f(e),f=e=>btoa(unescape(encodeURIComponent(e))),b=e=>decodeURIComponent(escape(atob(e))),y=e=>e?e.split("&c=${AAX_PAYLOAD}").join(""):e,I=e=>{var t;let i=o().getTreatment();return 1004!==e&&null!=(t=null==i?void 0:i.startsWith("t"))&&t},E=()=>{let e=o().getTreatment();return e?100*parseInt(e.substring(1)):0};var S=function(e){console.debug(e)},T=function(e,t){console.error(e,JSON.stringify(t)),x("ERROR",e,A(e,t))},C=function(e,t){console.error(e,JSON.stringify(t)),x("FATAL",e,A(e,t))},x=function(e,t,i){var a;null==(a=window.ueLogError)||a.call(window,i,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},A=function(e,t){return t instanceof Error?t:t?Error(t):Error(e)};class k{constructor(e={},t={},i={}){this.adMap=e,this.ADS_HANDLERS=t,this.viewableLatencyTrackers=i}}class M{constructor(e){this.adMap=e,this.sendMessageToAd=(e,t,i)=>{this.adMap[e].messagePort.postMessage({command:t,data:i})},this.sendCustomMessageToAd=(e,t,i)=>{this.sendMessageToAd(e,"customMessage",{key:t,data:i})}}}class N{constructor(e,t){this.supportedCommands=e,this.eventsChannel=t,this.receiveMessage=async({data:{command:e,adDetails:t,payload:i}})=>{try{let a={...this.eventsChannel,...this.supportedCommands}[e];a&&await a(t,i)}catch(e){T("Problem with message: "+JSON.stringify(i),e)}}}}let _=e=>e+"_Feedback";class R{async addSponsoredLabelWithFeedbackLink(e,t){e.appendChildTo(this.parentHtmlId,this);let i=await t.getSponsoredLabelAndFeedbackLink(this.urlPathAndParameter);if(!(null==i?void 0:i.isOk()))throw Error(`Result from the feedback service was not ok ${this.urlPathAndParameter}`);e.updateElement(this.getHtmlId(),i)}getHtmlId(){return _(this.parentHtmlId)}isHidden(){return this.hidden}exists(e){return e.exists(this.getHtmlId())}getFeedbackSpanElement(){return document.querySelector(`#${this.getHtmlId()} span`)}constructor(e,t,i,a,n,r,s){this.parentHtmlId=e,this.feedbackStyle=t,this.labelText=i,this.labelStyle=a,this.position=n,this.urlPathAndParameter=r,this.hidden=s}}class D{open(e){e.clickChildLink(this)}getHtmlId(){return _(this.parentHtmlId)}constructor(e){this.parentHtmlId=e}}class L{async createSponsoredLabelWithFeedbackLink(e,t){if(!e.exists(this.feedbackHtmlPort)){t.request();try{await e.addSponsoredLabelWithFeedbackLink(this.feedbackHtmlPort,this.feedbackApiPort),t.success(),e.isHidden()||t.labelRenderedHost()}catch(e){throw t.error(),e}}}openModal(e){e.open(this.feedbackHtmlPort)}labelRendered(e){e.labelRenderedCreative()}logTransparencyInfoMissing(e){e.transparencyInfoMissing()}constructor(e,t){this.feedbackHtmlPort=e,this.feedbackApiPort=t}}var O=/(\/b|\/s|\/l).*(node=)(\d{1,12})/,F=new Map,z=function(){if(!F.has(window.location.href)){var e=O.exec(window.location.href),t=e&&e[3]?e[3]:null;F.set(window.location.href,t)}return F.get(window.location.href)},U=function(e){var t=z();if(!e||!t)return null;var i=e.split(":");return i.splice(i.length-1,0,t),i.join(":")},V=function(e){var t=z();return t?"".concat(e,":").concat(t):null},H=function(e){return e.replace(/_/g,":")},B=function(e,t,i){if(void 0===i&&(i=1),W()){var a=function(e,t,i){t&&J("".concat(G(e),":").concat(t),i)};a(e,t.id,i),a(e,V(t.id),i),a(e,H(t.name),i),a(e,U(H(t.name)),i)}},$=function(e,t){void 0===t&&(t=1),W()&&J(G(e),t)},W=function(){var e;return"function"==typeof(null==(e=null==window?void 0:window.ue)?void 0:e.count)},J=function(e,t){var i;return null==(i=null==window?void 0:window.ue)?void 0:i.count(e,t)},q="adplacements",G=function(e){return e.startsWith(q)?e:"".concat(q,":").concat(e)},K=function(e){if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("setEntity",{adCreativeMetaData:e})}catch(e){T("Error with 'setEntity' CSA",e)}},Z=function(e,t,i){if(void 0===i&&(i=1),window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e+":"+t.name+":"+t.id,metricValue:i},{ent:"all"})}catch(e){T("Error with 'logCsaEvent' CSA",e)}},j=function(e,t){if(void 0===t&&(t=1),window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e,metricValue:t},{ent:"all"})}catch(e){T("Error with 'incrementCounter' CSA",e)}};let X=e=>new ee(e),Q={REQUEST:"adfeedback_request",SUCCESS:"adfeedback_success",ERROR:"adfeedback_error",LABEL_RENDERED_CREATIVE:"adfeedback_sponsoredlabelrendered_creative",LABEL_RENDERED_HOST:"adfeedback_sponsoredlabelrendered_host"},Y={REQUEST:"adfeedback:request",SUCCESS:"adfeedback:success",ERROR:"adfeedback:error",LABEL_RENDERED_CREATIVE:"adfeedback:sponsoredlabelrendered:creative",LABEL_RENDERED_HOST:"adfeedback:sponsoredlabelrendered:host",LABEL_RENDERED:"adfeedback:sponsoredlabelrendered",TRANSPARENCY_INFO_MISSING:"adfeedback:transparencyinfo:missing"};class ee{request(){B(Y.REQUEST,this.placement),$(Y.REQUEST),Z(Q.REQUEST,this.placement)}success(){B(Y.SUCCESS,this.placement),$(Y.SUCCESS),Z(Q.SUCCESS,this.placement)}error(){B(Y.ERROR,this.placement),Z(Q.ERROR,this.placement)}labelRenderedCreative(){B(Y.LABEL_RENDERED_CREATIVE,this.placement),$(Y.LABEL_RENDERED),Z(Q.LABEL_RENDERED_CREATIVE,this.placement)}labelRenderedHost(){B(Y.LABEL_RENDERED_HOST,this.placement),$(Y.LABEL_RENDERED),Z(Q.LABEL_RENDERED_HOST,this.placement)}transparencyInfoMissing(){B(Y.TRANSPARENCY_INFO_MISSING,this.placement),$(Y.TRANSPARENCY_INFO_MISSING)}constructor(e){this.placement=e}}class et{isOk(){return"ok"===this.status}constructor(e,t,i){this.status=e,this.html=t,this.script=i}}class ei{async getSponsoredLabelAndFeedbackLink(e){let t=await window.fetch(this.windowRepo.origin()+e);if(t.ok){let e=await t.json();return new et(e.status,e.html,e.script)}throw Error("Could not fetch the feedback html/link/script/label")}constructor(e){this.windowRepo=e}}class ea{appendChildTo(e,t){var i,a;function n(e,t){let i=document.createElement("div");return i.setAttribute("id",t.getHtmlId()),i.classList.add("ape-feedback"),i.style.position="relative",i.style.height="auto",i.style.minHeight="20px",i.style.textAlign=i.id.includes("hero-quick-promo_Desktop_placement_Feedback")?"left":"right",i.style.padding="0",i.style.marginTop="2px",i.style.display=t.feedbackStyle.display,e.endsWith("_wrapper")&&(e.includes("-ilm")||(i.style.maxWidth="min(100vh, 100vw)"),i.style.marginLeft="auto",i.style.marginRight="auto",i.style.padding="0 5px"),i.append(function(e){let t=document.createElement("div");return t.innerHTML=e.labelText,en(t,e.labelStyle),t}(t)),i}1===t.position?null==(i=document.getElementById(e))||i.prepend(n(e,t)):0===t.position&&(null==(a=document.getElementById(e))||a.append(n(e,t)))}updateElement(e,t){let i=document.getElementById(e);if(i)for(let e of(i.innerHTML=t.html,er(i,t),i.children))"DIV"===e.tagName?e.removeAttribute("style"):"A"===e.tagName&&(e.style.removeProperty("position"),e.style.removeProperty("top"),e.style.removeProperty("right"),e.style.removeProperty("display"))}clickChildLink(e){let t=document.getElementById(e.getHtmlId());for(let e of(null==t?void 0:t.children)||[]){var i;if("A"===(i=e).tagName||"DIV"===i.tagName)return void e.click()}}exists(e){return!!document.getElementById(e)}}let en=(e,t)=>{for(let i in t)e.style.setProperty(i,t[i])},er=(e,t)=>{es(e).innerHTML=t.script},es=e=>{let t=document.createElement("script");return e.prepend(t),t},el={code:"BE",hostname:"www.amazon.com.be",name:"Belgium"},eo={code:"FR",hostname:"www.amazon.fr",name:"France"},ed={code:"DE",hostname:"www.amazon.de",name:"Germany"},ec={code:"IT",hostname:"www.amazon.it",name:"Italy"},em={code:"NL",hostname:"www.amazon.nl",name:"Netherlands"},eh={code:"PL",hostname:"www.amazon.pl",name:"Poland"},eu={code:"ES",hostname:"www.amazon.es",name:"Spain"},ep={code:"SE",hostname:"www.amazon.se",name:"Sweden"},eg=e=>location.hostname===e.hostname,ev=()=>eg(el)||eg(eo)||eg(ed)||eg(ec)||eg(em)||eg(eh)||eg(eu)||eg(ep),ew=e=>!ev()||ef(e),ef=e=>{var t,i,a,n,r,s;let l=[];ey(null==e||null==(a=e.url)||null==(i=a.parameters)||null==(t=i.adPlacementMetaData)?void 0:t.slotName)&&l.push("DSA Error: slotName missing");let o=null==e||null==(s=e.url)||null==(r=s.parameters)||null==(n=r.adCreativeMetaData)?void 0:n.adCreativeDetails;for(let e of((!o||o.length<=0)&&l.push("DSA Error: transparency info missing"),null==o||o.every(e=>eb(e,l)),l))T(e);return l.length<=0},eb=(e,t)=>{var i,a,n,r,s;e.version||t.push("DSA Error: version missing"),ey(e.advertiserIdNS)&&t.push("DSA Error: advertiserIdNS missing"),((null==(i=e.selectionSignals)?void 0:i.context)===void 0||(null==(a=e.selectionSignals)?void 0:a.context)===null)&&t.push("DSA Error: selectionSignals.context missing"),((null==(n=e.selectionSignals)?void 0:n.location)===void 0||(null==(r=e.selectionSignals)?void 0:r.location)===null)&&t.push("DSA Error: selectionSignals.location missing"),ey(null==(s=e.selectionSignals)?void 0:s.pastActivity)&&t.push("DSA Error: selectionSignals.pastActivity missing")},ey=e=>!(null==e?void 0:e.trim()),eI=()=>new eE(new L(new ea,new ei({origin:()=>window.location.origin})));class eE{async addSponsoredLabel({parentHtmlId:e,placement:t,feedback:i}){return ew(i)?(i.hidden&&(Object.assign(i.style,{display:"none"}),Object.assign(i.label.style,{display:"none"})),await this.feedbackService.createSponsoredLabelWithFeedbackLink(eP(e,i),X(t)),!0):(this.feedbackService.logTransparencyInfoMissing(X(t)),T("Transparency Information missing"),!1)}openModal(e){this.feedbackService.openModal(new D(e))}labelRendered({placement:e}){this.feedbackService.labelRendered(X(e))}constructor(e){this.feedbackService=e}}let eS=e=>"/af/feedback-link?pl="+e,eP=(e,t)=>{let i=JSON.parse(JSON.stringify(t.url.parameters));return i.adPlacementMetaData.pageUrl=w(i.adPlacementMetaData.pageUrl),new R(e,t.style,t.label.text,t.label.style,+("TOP"===t.position),eS(encodeURIComponent(JSON.stringify(i))),t.hidden)},eT=e=>{eI().labelRendered({placement:{id:e.placementId,name:e.placementName}})},eC=e=>{var t;eI().openModal(null!=(t=e.adUnitWrapperId)?t:e.adUnitPlacementId)},ex=async e=>{if(!await eI().addSponsoredLabel(eA(e)))throw Error("Failed to create sponsored label and feedback link")},eA=e=>{var t;let i=e.adPlacementMetaData,a=e.adFeedbackInfo;return{parentHtmlId:null!=(t=e.adUnitWrapperId)?t:e.adUnitPlacementId,placement:{id:e.placementId,name:e.placementName},feedback:{position:"BOTTOM",hidden:!a.boolFeedback,style:e.feedbackDivStyle,url:{parameters:{adPlacementMetaData:{adElementId:i.adElementId,pageType:i.pageType,pageUrl:w(i.pageUrl),slotName:i.slotName},adCreativeMetaData:e.adCreativeMetaData}},label:{text:v(a.sponsoredText),style:e.advertisementStyle}}}},ek={DESKTOP:16,MSHOP:10,MWEB:10},eM=e=>(null==e?void 0:e.length)>1&&"%"===e.charAt(e.length-1),eN=e=>eM(e)?e:`${parseInt(e)}px`,e_=(e,t="MWEB")=>{if(eM(e))return e;let i=parseFloat(e),a=ek[t];return i&&a?`${i/a}lh`:"inherit"},eR="APE_CW_METRICS",eD=!1,eL=e=>{eD||(window.addEventListener("beforeunload",()=>eV()),eD=!0);let t=eO();t.push(e),t.length>=10?eF(t):eU(t)},eO=()=>{let e=localStorage.getItem(eR);if(!e)return[];try{return JSON.parse(e)}catch(e){return[]}},eF=e=>{navigator.sendBeacon("https://qdbx3pbnx6veby23pzgaowu3q40tmmrr.lambda-url.us-east-1.on.aws",JSON.stringify(ez(e))),localStorage.removeItem(eR)},ez=e=>({metrics:e,xApiKey:"aUAZqFtiIp6VxqpW3coqZ2JdZnV3RN9S8yKMRIdJ"}),eU=e=>{localStorage.setItem(eR,JSON.stringify(e))},eV=()=>{let e=eO();e.length>0&&eF(e)},eH=({metricName:e,adDetails:t,count:a=1,additionalDimensions:n={}})=>{i().isT1()&&eL(e$(e,a,eW(t,n)))},eB=({metricName:e,adDetails:i,count:a=1,additionalDimensions:n={}})=>{t().isT1()&&eL(e$(e,a,eW(i,n)))},e$=(e,t,i)=>({metricName:e,timestamp:new Date().getTime(),value:t,dimensions:i}),eW=(e,t)=>{var i,a;return{app:"SF",siteName:e.siteName,slotName:e.slotName,pageType:e.pageType,placementId:e.placementId,mediaType:e.mediaType,programId:null==(i=e.adCreativeMetaData)?void 0:i.adProgramId,creativeTemplateName:null==(a=e.adCreativeMetaData)?void 0:a.adCreativeTemplateName,deviceType:e.deviceType,...t}},eJ=["desktop-detail-ilm","vindp-desktop-atf-ilm","fresh-desktop-detail-ilm","wfm-desktop-detail-ilm","alm-weis-desktop-detail-ilm","alm-save-desktop-detail-ilm","alm-lucky-desktop-detail-ilm","alm-bristol-desktop-detail-ilm","alm-rite-desktop-detail-ilm","alm-bartell-desktop-detail-ilm","alm-cardenas-desktop-detail-ilm","alm-petfoodexpress-desktop-detail-ilm","alm-allthebestpetcare-desktop-detail-ilm"];class eq{resize(e){var t;if(!this.isAllowedSize(e))return T(`Size w:'${e.width}', h:'${e.height}' is not allow-listed for '${this.name}'`),!1;let i=this.wrapperDiv,a=this.div;return null==(t=this.card)||t.style.setProperty("padding","0"),l().isT1()?"hero-quick-promo"===this.slotName&&(eM(e.width)?a.style.maxHeight=eN(e.height):(a.removeAttribute("style"),a.style.aspectRatio=`${parseInt(e.width)} / ${parseInt(e.height)}`)):eM(e.height)||eM(e.width)||"FIXED"===this.sizing?(a.style.width=eN(e.width),a.style.height=eN(e.height)):(a.removeAttribute("style"),a.style.aspectRatio=`${parseInt(e.width)} / ${parseInt(e.height)}`),i&&this.isImageOnly&&a.classList.add("is-image-oo"),!0}collapse(e,t){this.wrapperDiv&&(this.wrapperDiv.style.display="none"),this.div.style.display="none",eH({metricName:"placement:collapse",adDetails:e,additionalDimensions:{code:t,isBlank:`${eK(e)}`,creativeId:e.adCreativeMetaData.adCreativeId}})}get wrapperDiv(){return this.wrapperDivId?document.getElementById(this.wrapperDivId):null}get div(){return document.getElementById(this.divId)}get card(){return document.getElementById(`ape_${this.name}_aui_card`)}constructor(e,t,i,a,n,r,s,l=!1){this.id=e,this.name=t,this.wrapperDivId=i,this.divId=a,this.slotName=n,this.allowedSizes=r,this.sizing=s,this.isImageOnly=l,this.isAllowedSize=e=>this.allowedSizes.some(t=>eN(e.height)===t.height&&eN(e.width)===t.width)}}let eG=e=>eJ.includes(e),eK=e=>{let t=e.htmlContentEncoded.match(/<div id="ad">\s*(.*?)\s*<\/div>/s);return!!t&&""===t[1].trim()},eZ=(e,t=!1)=>ej(e,[],t),ej=(e,t,i=!1)=>{var a;return new eq(e.placementId,e.placementName,e.adUnitWrapperId,e.adUnitPlacementId,e.slotName,(null!=(a=e.allowedSizes)?a:[]).concat({height:eN(e.size.height),width:eN(e.size.width)}).concat(t.map(e=>({height:eN(e.height),width:eN(e.width)}))),e.sizing,i)},eX=()=>window.innerHeight||document.documentElement.clientHeight,eQ=()=>window.innerWidth||document.documentElement.clientWidth,eY=e=>e.getBoundingClientRect().top-eX(),e0=(e,t)=>({t:e.top,l:e.left,r:e.right,b:e.bottom,w:e.width,h:e.height,z:t}),e1=e=>e0(e.getBoundingClientRect(),Number(window.getComputedStyle(e,null).zIndex)),e2=e=>{let t=function(e){let t=document.body.getBoundingClientRect();if(e3(t))return null;let i=e1(e),a=eX(),n=eQ();return Number(Math.min(1,Math.max(0,Math.max(0,Math.min(t.left+n,i.r)-i.l)*Math.max(0,Math.min(t.top+a,i.b)-i.t)/(i.h*Math.min(i.w,n)))).toFixed(2))}(e);return null==t?"unknown":t>=.5},e3=e=>0===e.width&&0===e.height,e9=(e,t)=>{let i=e1(e),a=e1(t),n=eQ(),r=eX();return i&&a&&(Math.abs(i.t-a.b)<r||Math.abs(i.b-a.t)<r)&&(Math.abs(i.l-a.r)<n||Math.abs(i.r-a.l)<n)};function e5(e,t,i){var a,n=i||{},r=n.noTrailing,s=void 0!==r&&r,l=n.noLeading,o=void 0!==l&&l,d=n.debounceMode,c=void 0===d?void 0:d,m=!1,h=0;function u(){a&&clearTimeout(a)}function p(){for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];var l=this,d=Date.now()-h;function p(){h=Date.now(),t.apply(l,n)}function g(){a=void 0}!m&&(o||!c||a||p(),u(),void 0===c&&d>e?o?(h=Date.now(),s||(a=setTimeout(c?g:p,e))):p():!0!==s&&(a=setTimeout(c?g:p,void 0===c?e-d:e)))}return p.cancel=function(e){var t=(e||{}).upcomingOnly;u(),m=!(void 0!==t&&t)},p}let e6=e=>{window.addEventListener("scroll",e),window.addEventListener("resize",e),document.addEventListener("visibilitychange",e)},e4=e=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e),document.removeEventListener("visibilitychange",e)};var e8={wb:"ues",bb:"uet",af:"uet",cf:"uet",be:"uet",ld:"uex"},e7=function(e){var t,i,a=e.latencyEvent,n=e.scope,r=e.placement,s=e.timestamp;te(a)&&(tt(a,ti(n),r.id,s),tt(a,ti(n),H(r.name),s),tt(a,ti(n),null!=(t=U(r.name))?t:void 0,s),tt(a,ti(n),null!=(i=V(r.id))?i:void 0,s))},te=function(e){return"function"==typeof window[e8[e]]},tt=function(e,t,i,a){void 0===a&&(a=new Date);var n=e8[e];i&&"function"==typeof window[n]&&window[n](e,t+i,{wb:1},a)},ti=function(e){return"adplacements:"+ta(e)},ta=function(e){return e?"".concat(e,":"):""},tn=function(e,t,i){if(window.csa)try{window.csa("Content",{element:e})("mark",t,null==i?void 0:i.getTime())}catch(e){T("Error with 'mark' CSA",e)}};class tr{sendLatencyMetric({latencyMetricType:e,placementId:t,placementName:i,placementDivId:a,timestamp:n}){e7({latencyEvent:e.csmKey,scope:e.csmMessage,placement:{id:t,name:i},timestamp:n}),tn(document.getElementById(a),e.csaKey,n)}}let ts=()=>new tr,tl="sfImpression",to="LightAdImpression",td="viewablelatency",tc=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i}),tm=tc("bodyBegin","bb"),th=tc("bodyBegin","bb",tl);tc("bodyBegin","bb",to),tc("bodyEnd","be"),tc("clickToATF","af"),tc("criticalFeature","cf"),tc("criticalFeature","cf",tl),tc("criticalFeature","cf",to),tc("loaded","ld"),tc("loaded","ld",tl),tc("loaded","ld",to);let tu=tc("viewablelatency:bodyBegin","bb",td),tp=tc("viewablelatency:loaded","ld",td),tg=(e,t,i)=>e>0?i>e:t>0,tv=(e,t,i,a,n,r)=>{var s,l,o;let d=null==(o=document)||null==(l=o.getElementById)||null==(s=l.call(o,i))?void 0:s.getBoundingClientRect();if(d&&tg(d.top,d.bottom,eX())&&tg(d.left,d.right,eQ())){if(ts().sendLatencyMetric({latencyMetricType:tu,placementId:n,placementName:a,placementDivId:i,timestamp:new Date}),e[r].loaded){ts().sendLatencyMetric({latencyMetricType:tp,placementId:n,placementName:a,placementDivId:i,timestamp:new Date});let e={id:n,name:a};B("adplacements:htmlviewed:loaded:",e),B("adplacements:htmlviewed",e)}t.viewed=!0,e4(t.tracker)}},tw=(e,t)=>{if(!e[t.arid]){e[t.arid]={valid:!1};try{let i=e[t.arid];tv(e,i,t.adUnitPlacementId,t.placementName,t.placementId,t.arid);let a=m(e5(20,()=>{tv(e,i,t.adUnitPlacementId,t.placementName,t.placementId,t.arid)}),T);e6(a),i.tracker=a,i.valid=!0}catch(e){throw T("Error initializing viewable latency instrumentation",e),e}}},tf=e=>{try{B("coordinate:x",e,e.div.getBoundingClientRect().x),B("coordinate:y",e,e.div.getBoundingClientRect().y)}catch(e){return}},tb=e=>{$("resize:size:request"),ty(e)&&("100%"===e.size.width||"100%"===e.size.height?eB({metricName:"resize:size:differresponsive",adDetails:e}):eB({metricName:"resize:size:differfixed",adDetails:e})),tI(e)||(eB({metricName:"creativesize:slotsizediffer",adDetails:e}),$("resize:size:differ"))},ty=e=>{let t=(e,t)=>"100%"===e?0!==t:parseInt(e)!==t;return t(e.size.width,e.creative.size.width)||t(e.size.height,e.creative.size.height)},tI=e=>{let t=e.creative.size;return!t||0===t.width||0===t.height||e.slotSizes.some(e=>e.width===t.width&&e.height===t.height)},tE=(e,t)=>{let i=e=>eM(e)?e:parseInt(e),a=i(t.height),n=i(t.width),r=i(e.size.width),s=i(e.size.height);eB({metricName:"creative:size:changeSize",adDetails:e,additionalDimensions:{preSize:`${r}x${s}`,postSize:`${n}x${a}`}})},tS=(e,t,i)=>{ts().sendLatencyMetric({latencyMetricType:th,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId}),i&&(ts().sendLatencyMetric({latencyMetricType:tm,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId,timestamp:i}),e7({latencyEvent:"wb",placement:t,timestamp:i})),B("adload:start",t),Z("adload_start",t),B("adload:delayloadcallback",t),Z("adload_delayload",t)};class tP{constructor(e,t){this.hc=e,this.hmr=t,this.collapsedPlacements=new Set,this.initializeAdMap=(e,t)=>{try{this.hc.adMap[e.arid]={messagePort:t}}catch(t){T(`Error creating safeFrame ${e.slotName}`,t)}},this.secondPhaseLoadAd=async(e,t,i,a)=>{await this.setupMessageChannel(i,t,a)},this.setupMessageChannel=async(e,t,i)=>{var a,n;null==(n=performance)||null==(a=n.mark)||a.call(n,`SafeFrame: Start setupMessagePort ${t.adUnitPlacementId}`),this.initializeAdMap(t,e);let r=this.hc;r.ADS_HANDLERS[t.arid]=r.ADS_HANDLERS[t.arid]||{};let l=eZ(t);l.resize(t.size),tb(t),tf(l),tS(t,l,i),tw(r.viewableLatencyTrackers,t);try{s().isT1()||await ex(t),tT(r,t,this.hmr)}catch(e){throw l.collapse(t,"HOSTSETUP"),e}}}}let tT=(e,t,i)=>{e.adMap[t.arid].messagePort.onmessage=i.receiveMessage},tC="cod_client",tx=async(e,t)=>{if(e&&e.trim().match(/^\d{1,4}px$/g))return await tA(parseInt(e,10),t,(e,t)=>{let i=eY(e);return e&&i<=t})},tA=async(e,t,i)=>new Promise(a=>{let n=()=>{i(t,e)&&(a(),window.removeEventListener("scroll",r),window.removeEventListener("resize",r))},r=m(e5(20,()=>{n()}),T);window.addEventListener("scroll",r),window.addEventListener("resize",r),n()}),tk=(e,t,i,a,n,r)=>{let s=null==e?void 0:e[t];(null==s?void 0:s.valid)&&(s.loaded=!0,s.viewed&&(ts().sendLatencyMetric({latencyMetricType:tp,placementId:a,placementName:i,placementDivId:n,timestamp:new Date(r)}),B("htmlviewed:loaded",{id:a,name:i})))},tM=async(e,t)=>{let i,a;return new Promise(n=>{a=n,(i=new IntersectionObserver(t=>{t.forEach(t=>{t.target===e&&t.isIntersecting&&(a(t),i.unobserve(e))})},t)).observe(e)})},tN=e=>{let t=document.getElementById(e.adUnitIframeId);return t||($("getiframe:undefined"),eB({metricName:"html:element:missing:iframe",adDetails:e})),t},t_=async e=>{let t=tN(e),i={root:tR(t)?null:document.documentElement};await tM(t,i)},tR=e=>{let t=e;for(;t;){if("fixed"===window.getComputedStyle(t,null).getPropertyValue("position"))return!0;t=t.parentElement}return!1},tD=e=>{let t=document.getElementById(e.adUnitPlacementId);return t||($("getplacement:undefined"),eB({metricName:"html:element:missing:placement",adDetails:e})),t},tL=async(e,t)=>{t.firePixelsAfter&&await tx(t.firePixelsAfter,tD(t)),await t_(t),e.sendMessageToAd(t.arid,"fireImpression",{measurementMethod:tC,isNoInventory:!1})},tO="gw-video-orchestrator",tF=(e,t,i)=>{var a;null==(a=window.P)||a.when(tO).execute(a=>{try{a.subscribe(e,t,i)}catch(e){S(`gw-video-orchestrator error: ${JSON.stringify(e)}`)}})},tz=e=>tV(e),tU=()=>tV(),tV=e=>{var t;null==(t=window.P)||t.when(tO).execute(t=>{t.elect(e)})},tH=null,tB=(e,t,i)=>{let a=t=>i.sendCustomMessageToAd(e.arid,"videoAutoplayResponse",t);tJ(e.pageType)?tF(tN(e),a,t):tH===e.arid?a(!0):null===tH&&tq(tN(e))?(tH=e.arid,a(!0)):a(!1)},t$=()=>{tU(),tH=null},tW=e=>{tz(tN(e)),tH=e.arid},tJ=e=>(null==e?void 0:e.toLowerCase())==="gateway",tq=e=>![...document.getElementsByTagName("video")].some(t=>!t.paused&&e9(e,t)),tG=(e,t,i)=>{if(""===t)throw Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));let a=new URL(e),n=Object.assign(JSON.parse(a.searchParams.get(t)||"{}"),i);return a.searchParams.set(t,JSON.stringify(n)),a.toString()};class tK{async fire(e,t={}){this.isFired||(await fetch(this.pixelUrl(this.url,e),{keepalive:!0,mode:"no-cors",...t}),e.div.appendChild(this.pixel(e)),this.isFired=!0,this.logOnFirePixel(this.loggingContext,e))}logOnFirePixel(e,t){var i;$(`pixel:${this.logId}`),B(`pixel:${this.logId}`,t),$(`pixel:${this.logId}:${e.aaxProgramId}`),$(`pixel:${this.logId}:device:${null==(i=t.deviceType)?void 0:i.toLowerCase()}`)}constructor(e,t,i,a){this.url=e,this.loggingContext=a,this.isFired=!1,this.pixel=e=>{let t=document.createElement("img");return t.id=`${this.pixelId}_${e.name}`,t.style.display="none",t.setAttribute("pixel-url",this.pixelUrl(this.url,e)),t}}}class tZ extends tK{constructor(e,t,i,a){super(e,t,i,a),this.pixelId="ape_impression",this.logId="imp:cod",this.pixelUrl=(e,t)=>{let i=e.includes(".paets.");return tG(e,"pj",i?{}:this.pixelUrlParametersLegacy())},this.pixelUrlParametersLegacy=()=>({measurementMethod:tC})}}class tj extends tK{constructor(e,t,i,a){super(e,t,i,a),this.pixelId="ape_measurability",this.logId="imp:atf",this.pixelUrl=(e,t)=>`${e.replace(/\/$/,"")}/atf/${JSON.stringify(this.pixelUrlParameters(t))}`,this.pixelUrlParameters=e=>({atf:e2(e.div)})}}let tX="AppAdsMshopIOSPlugin",tQ=e=>{var t;null==(t=window.P)||t.when(tX).execute(t=>{t.startAttributeViewThroughAppAds({skAdNetwork:e})})},tY=e=>{var t;null==(t=window.P)||t.when(tX).execute(t=>{t.endAttributeViewThroughAppAds({skAdNetwork:e})})};class t0 extends tZ{async fire(e){this.isFired||(tQ(this.skAdNetwork),this.isFired=!0,this.logOnFirePixel(this.loggingContext,e))}constructor(e,t,i,a,n){super(e,t,i,a),this.skAdNetwork=n,this.logId="imp:skan"}}let t1=(e,t)=>{let i=t3(t),a=0;for(let[t,n]of i){if(!t9(t,n))continue;let i=document.elementFromPoint(t,n);i&&t2(i,e)&&a++}return a/i.length},t2=(e,t)=>{if(!(e instanceof HTMLElement)||e===t||t.contains(e))return!1;let i=window.getComputedStyle(e);if("none"===i.display||"hidden"===i.visibility||"none"===i.pointerEvents||.7>parseFloat(i.opacity))return!1;let a=i.backgroundColor;return!("transparent"===a||/,0\)$/.test(a))&&""!==a||!!i.backgroundImage.includes("url")},t3=e=>{let t=[];for(let i=0;i<10;i++)t.push([e.left+e.width/2,e.top+e.height*(i+.5)/10]);return t},t9=(e,t)=>{let i=window.innerWidth||document.documentElement.clientWidth,a=window.innerHeight||document.documentElement.clientHeight;return e>=0&&e<=i&&t>=0&&t<=a},t5=e=>{let t=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth,a={top:Math.max(0,e.top),left:Math.max(0,e.left),bottom:Math.min(t,e.bottom),right:Math.min(i,e.right)};if(e.top>=t||e.left>=i||e.bottom<=0||e.right<=0||e.width<=0||e.height<=0)return 0;let n=(a.right-a.left)*(a.bottom-a.top);return n/(e.width*e.height)},t6=(e,t)=>{let i=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return 0===i||0===a?0:i*a/(e.width*e.height)},t4=e=>{let{height:t,top:i,left:a=0,width:n=eQ()}=e;return{top:i,bottom:i+t,left:a,right:a+n,width:n,height:t}},t8=e=>(null==e?void 0:e.toLowerCase())==="mshop",t7=e=>{var t;let i=e.placement.div.getBoundingClientRect();return{v:{def:e.definition,p:e.thresholdPercentage,t:e.thresholdTimeVisibleMs,ib:e.isBtr},wh:window.innerHeight||document.documentElement.clientHeight,ww:window.innerWidth||document.documentElement.clientWidth,sx:window.scrollX,sy:window.scrollY,ah:i.height,aw:i.width,top:i.top,left:i.left,ptv:(new Date().getTime()-(null!=(t=window.aPageStart)?t:0))/1e3,ttv:(new Date().getTime()-e.adStartTime)/1e3}},ie=e=>t8(e.deviceType)?"viewPixel:iab:mshop:fired":"viewPixel:iab:fired",it=e=>{let t=e.name.toLowerCase();return t.includes("h1")||t.includes("wd-1")};class ii extends tK{postPixelFireCleanup(e,t){e.unobserve(t.div),clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),this.visibilityChangeService.removeVisibilityChangeDetection(),this.emitObstructionRecoveryMetrics(t),this.viewabilityService.removeNativeObstructionsChangedListener()}postPlacementExitsViewportCleanup(){clearTimeout(this.viewTimerTimeoutId),clearTimeout(this.legacyViewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),clearInterval(this.shouldFirePixelIntervalId),this.visibilityChangeService.removeVisibilityChangeDetection()}fireInObserver(e,t){this.fire(t),this.postPixelFireCleanup(e,t)}startInViewTimer(e,t){this.viewTimerTimeoutId=setTimeout(()=>this.fireInObserver(e,t),this.thresholdTimeVisibleMs),this.isIab()&&this.performContinuousObstructionCheck(e,t),this.visibilityChangeService.setupVisibilityChangeDetection(this.viewTimerTimeoutId,e,t)}startLegacyInViewTimer(e){this.legacyViewTimerTimeoutId=setTimeout(()=>this.emitLegacyFiredViewMetric(e),this.thresholdTimeVisibleMs)}performContinuousObstructionCheck(e,t){this.obstructionCheckIntervalId=setInterval(()=>{try{this.viewabilityService.isViewabilityObstructed(t,this.thresholdPercentage)&&(this.wasObstructed=!0,clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),this.startInViewTimer(e,t))}catch(e){C(null==e?void 0:e.message,e),clearInterval(this.obstructionCheckIntervalId)}},100)}track(e){new IntersectionObserver((t,i)=>{t.forEach(t=>{t.isIntersecting?this.thresholdTimeVisibleMs>0?(this.startInViewTimer(i,e),this.startLegacyInViewTimer(e)):this.fireInObserver(i,e):this.postPlacementExitsViewportCleanup()})},{threshold:this.thresholdPercentage}).observe(e.div)}async fire(e){if(this.videoPixelValidator&&!this.videoPixelValidator.shouldFirePixel()&&await this.waitUntilShouldFirePixel(),this.impressionPixel&&I(this.loggingContext.aaxProgramId)){await this.impressionPixel.fire(e,{priority:"high"});let t={priority:"low"};setTimeout(()=>{super.fire(e,t)},E())}else super.fire(e)}waitUntilShouldFirePixel(){return new Promise(e=>{this.shouldFirePixelIntervalId=setInterval(()=>{this.videoPixelValidator&&this.videoPixelValidator.shouldFirePixel()&&(clearInterval(this.shouldFirePixelIntervalId),e())},100)})}get pixelId(){return`ape_viewability_${this.definition}`}set isBtr(e){this._isBtr=e}constructor(e,t,i,a,n,r,s,l,o,d,c){super(e,t,i,a),this.thresholdPercentage=n,this.thresholdTimeVisibleMs=r,this.definition=s,this.visibilityChangeService=l,this.viewabilityService=o,this.impressionPixel=d,this.videoPixelValidator=c,this._isBtr=!1,this.adStartTime=new Date().getTime(),this.metricsLogged=new Set,this.wasObstructed=!1,this.pixelUrl=(e,t)=>{let i={placement:t,definition:this.definition,thresholdPercentage:this.thresholdPercentage,thresholdTimeVisibleMs:this.thresholdTimeVisibleMs,isBtr:this._isBtr,adStartTime:this.adStartTime};return`${e.replace(/\/+$/,"")}/v/${JSON.stringify(t7(i))}`},this.emitObstructionRecoveryMetrics=e=>{this.wasObstructed&&this.logMetrics("viewpixel:iab:obstruction:recovered",1,e)},this.emitLegacyFiredViewMetric=e=>{let t=ie(e);this.logMetrics(t,1,e),clearTimeout(this.legacyViewTimerTimeoutId)},this.logMetrics=(e,t=1,i)=>{!this.metricsLogged.has(e)&&this.isIab()&&($(e,t),j(e,t),i&&(B(e,i,t),Z(e,i,t)),this.metricsLogged.add(e))},this.isIab=()=>"iab"===this.definition,this.logId=`view:${this.definition}`}}class ia extends ii{get pixelId(){return"skan_view_pixel"}async fire(e){this.isFired||(tY(this.skAdNetwork),this.isFired=!0,this.logOnFirePixel(this.loggingContext,e))}constructor(e,t,i,a,n,r,s,l){super(e,t,i,a,.5,2e3,"",r,s,void 0,l),this.skAdNetwork=n,this.logId="view:skan",this.pixelUrl=()=>{throw Error("PixelUrl should not be use for SkanViewPixel")}}}class ir extends tZ{constructor(e,t,i,a){super(e,t,i,a),this.pixelId="ape_btr_impression",this.logId="imp:btr",this.pixelUrl=(e,t)=>tG(y(e),"c",{measurementMethod:"btr_client"})}}let is={H1_DESKTOP_HEIGHT:240,H1_DESKTOP_WIDTH:940},il=e=>{if(io(e)){let t={height:is.H1_DESKTOP_HEIGHT,width:is.H1_DESKTOP_WIDTH};return id(e.div,t)}return e.div.getBoundingClientRect()},io=e=>"gateway_desktop-h1_desktop"===e.name.toLowerCase(),id=(e,t)=>{let i=e.getBoundingClientRect();return new DOMRect((i.left+i.right)/2-t.width/2,i.y,t.width,t.height)},ic=e=>{let t=new Set,i=(e,i=1,a)=>{t.has(e)||($(e,i),j(e,i),a&&(B(e,a,i),Z(e,a,i)),t.add(e))},a=(e,t)=>{i("viewpixel:iab:obstruction",1,e),i(im(t),1,e),"Native"===t&&i("viewPixel:iab:obstruction:native:y:top",e.div.getBoundingClientRect().top,e)},r=(t,i,n,r)=>{let s=i-e.getDOMObstructionPercentage(t.div,r)<n;return s&&a(t,"DOM"),s},s=(t,i,n,r)=>{if(t8(t.deviceType)){let s=i-e.getNativeObstructionPercentage(r)<n;return s&&a(t,"Native"),s}return!1};return{isViewabilityObstructed(e,t){if(n().isT1()&&it(e))return!1;let i=il(e),a=t5(i);return r(e,a,t,i)||s(e,a,t,i)},removeNativeObstructionsChangedListener(){e.removeNativeObstructionsChangedListener()}}},im=e=>"DOM"===e?"viewPixel:iab:obstruction:UXElement":"viewPixel:iab:obstruction:native",ih="mash",iu=async e=>new Promise((t,i)=>{if(!P)return void i(Error("mash:getobstructions:missing"));let a=setTimeout(()=>{i(Error("mash:getobstructions:timeout"))},e),n=performance.now();P.when(ih).execute(e=>{var r,s;if(!(null==e||null==(s=e.appCX)||null==(r=s.uiOrchestrator)?void 0:r.getObstructions)){clearTimeout(a),i(Error("mash:getobstructions:missing"));return}e.appCX.uiOrchestrator.getObstructions({successCallback:e=>{clearTimeout(a),t({boundingBoxes:(e.boundingBoxes||[]).map(t4),isFullyObstructed:e.isFullyObstructed,latencyMs:performance.now()-n})},failCallback:()=>{clearTimeout(a),i(Error("mash:getobstructions:failure"))}})})}),ip=e=>{if(!P)return void $("mash:missing",1);P.when(ih).execute(t=>{null==t||t.addEventListener("obstructionsChanged",e)})},ig=e=>{if(!P)return void $("mash:missing",1);P.when(ih).execute(t=>{null==t||t.removeEventListener("obstructionsChanged",e)})},iv=async e=>new Promise((t,i)=>{if(!P)return void i(Error("mash:getbottombars:missing"));let a=setTimeout(()=>{i(Error("mash:getbottombars:timeout"))},e),n=performance.now();P.when("ConfigChromeFramework").execute(e=>{e.getBottomBarsHeight({successCallback:e=>{clearTimeout(a),t({heightPx:e.visibleHeight,latencyMs:performance.now()-n})},failCallback:()=>{i(Error("mash:getbottombars:failure"))}})})}),iw=async e=>new Promise((t,i)=>{if(!P)return void i(Error("mash:getchromeinfo:missing"));let a=setTimeout(()=>{i(Error("mash:getchromeinfo:timeout"))},e),n=performance.now();P.when("MShopChrome").execute(e=>{e.getChromeInfo({successCallback:e=>{clearTimeout(a),t({heightPx:e.portraitChromeHeight,isOverlapping:e.isTransparentNav,latencyMs:performance.now()-n})},failCallback:()=>{i(Error("mash:getchromeinfo:failure"))}})})}),ib=e=>e.filter(e=>16!==Math.round(e.height)||0!==e.top),iy=()=>{let e=[],t=!1,i=new Set,n=t=>{var i;e=((null==t||null==(i=t.detail)?void 0:i.boundingBoxes)||[]).map(t4)},r=e=>{if(e.isFullyObstructed)return l("viewPixel:iab:obstruction:native:fullviewport",1),[t4({height:window.innerHeight,top:0})];let t=ib(e.boundingBoxes);return o(e.boundingBoxes,t),t.map(t4)};(async()=>{try{if(e=[],a().isT1()){t||(ip(n),t=!0);let i=await iu(950);e=r(i);return}let i=await iv(950);l("mash:getbottombars:latency",i.latencyMs),i.heightPx>0&&(l("mash:getbottombars:response:height",i.heightPx),e.push(t4({height:i.heightPx,top:eX()-i.heightPx})));let s=await iw(950);l("mash:gettopnav:latency",s.latencyMs),s.isOverlapping&&s.heightPx>0&&(l("mash:topchrome:response:height",s.heightPx),e.push(t4({height:s.heightPx,top:0})))}catch(e){l(e.message)}})();let s=t=>0===e.length?0:e.reduce((e,i)=>e+t6(t,i),0),l=(e,t=1,a)=>{i.has(e)||($(e,t),j(e,t),a&&(B(e,a,t),Z(e,a,t)),i.add(e))},o=(e,t)=>{let i=e.length-t.length;for(let e of(i>0&&l("mash:getobstructions:filtered:count",i),t))l("mash:getobstructions:response:height",e.height),l("mash:getobstructions:response:top",e.top)};return{getNativeObstructionPercentage:e=>s(e),getDOMObstructionPercentage:(e,t)=>t1(e,t),removeNativeObstructionsChangedListener(){a().isT1()&&t&&ig(n)}}},iI=()=>{let e=(e,t,i)=>{document.hidden?(clearTimeout(e),t.unobserve(i.div)):t.observe(i.div)};return{removeVisibilityChangeDetection(){this.activeVisChangeHandler&&(document.removeEventListener("visibilitychange",this.activeVisChangeHandler),this.activeVisChangeHandler=void 0)},setupVisibilityChangeDetection(t,i,a){this.removeVisibilityChangeDetection(),this.activeVisChangeHandler=()=>e(t,i,a),document.addEventListener("visibilitychange",this.activeVisChangeHandler)}}},iE=e=>e.btrPixelUrl?new ir(e.btrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext):void 0,iS=e=>new tZ(e.aaxImpPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext),iP=e=>new tj(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext),iT=e=>new ii(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,0,0,"amzn",iI(),ic(iy())),iC=(e,t,i,a,n)=>{let r=ic(iy());if("V"===e){if(!n)throw Error("videoPixelValidator is required for video media type");return iM(i,r,n)}return ix(a)&&iA(t)?iN(i,r):i_(i,r)},ix=e=>"DESKTOP"===e,iA=e=>ik(e)>=242500,ik=e=>e.getBoundingClientRect().height*e.getBoundingClientRect().width,iM=(e,t,i)=>new ii(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,.5,2e3,"iab",iI(),t,iS(e),i),iN=(e,t)=>new ii(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,.3,1e3,"iab",iI(),t,iS(e)),i_=(e,t)=>new ii(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,.5,1e3,"iab",iI(),t,iS(e)),iR=e=>new ii(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,1,1e3,"groupm",iI(),ic(iy())),iD=e=>{if(e.skAdNetwork)return new t0(e.aaxImpPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,e.skAdNetwork)},iL=e=>{if(e.skAdNetwork)return new ia(e.aaxInstrPixelUrl,e.abpAcceptable,e.abpStatus,e.loggingContext,e.skAdNetwork,iI(),ic(iy()))},iO="btr:impression";var iF=function(e,t){iz()&&iU(e+iV(t))},iz=function(){var e;return"function"==typeof(null==(e=null==window?void 0:window.ue)?void 0:e.tag)},iU=function(e){var t;return null==(t=null==window?void 0:window.ue)?void 0:t.tag(e)},iV=function(e){return e?":".concat(e):""};let iH=e=>{if(!(null==e?void 0:e.adCreativeMetaData)||!Object.keys(e.adCreativeMetaData).length){iF("noadrender"),K({adrender:"false"});return}iF("adrender"),iF("adrender:safeframe"),iB(e),iW(e),iJ(e),iq(e)},iB=e=>{let t=i$(e);iF("adrender","creativetemplatename:"+t),K({adrender:"true",creativeTemplateName:t,isLightAds:"false"})},i$=e=>e.adCreativeMetaData.adCreativeTemplateName?e.adCreativeMetaData.adCreativeTemplateName.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",iW=e=>{e.adCreativeMetaData.adCreativeId&&(iF("adrender","creativeid:"+e.adCreativeMetaData.adCreativeId),K({creativeId:e.adCreativeMetaData.adCreativeId}))},iJ=e=>{e.adCreativeMetaData.adProgramId&&(iF("adrender","programid:"+e.adCreativeMetaData.adProgramId),K({adProgramId:e.adCreativeMetaData.adProgramId}))},iq=e=>{void 0!==e.isCardsFlow&&K({isCardsFlow:e.isCardsFlow.toString()})},iG=async e=>{var t;e.firePixelsAfter&&await tx(e.firePixelsAfter,tD(e)),await t_(e),null==(t=iE(ae(e)))||t.fire({id:e.placementId,name:e.placementName,div:tD(e),deviceType:e.deviceType}),iK(e)},iK=e=>{B(iO,{id:e.placementId,name:e.placementName},1),$(iO,1),$(iO+":program:"+(e.adCreativeMetaData.adProgramId?e.adCreativeMetaData.adProgramId:"unknown"),1),$(iO+":template:"+i$(e),1)},iZ=(e,t)=>{T(t.message+": "+e.placementName,t.error),T(t.message,t.error)},ij=(e,t)=>{C(t.message+": "+e.placementName,t.error)},iX=(e,t)=>{var i,a;let n=Error(t.message);null==(i=(a=window).ueLogError)||i.call(a,n,{logLevel:"ERROR",attribution:"sf-blank-ads",message:t.message+" | "})},iQ=(e,t)=>{if(r().isT1()){var i,a;if(S("ChangeSize API has been deprecated"),!("hero-quick-promo"===e.slotName&&((null==(i=e.adCreativeMetaData)?void 0:i.adCreativeTemplateName)==="Personalized Responsive eCommerce"||!(null==(a=e.adCreativeMetaData)?void 0:a.adCreativeTemplateName))))return}else S("ChangeSize API is being deprecated");!iY(e,t)&&eZ(e).resize(t)&&tE(e,t)},iY=(e,t)=>eN(e.size.width)===eN(t.width)&&eN(e.size.height)===eN(t.height),i0=(e,t)=>Z(t.metricName,{name:e.placementName,id:e.placementId}),i1=async e=>{var t,i;let a=ae(e),n={id:e.placementId,name:e.placementName,div:tD(e),deviceType:e.deviceType};await (null==(t=iD(a))?void 0:t.fire(n)),null==(i=iL(a))||i.track(n)},i2="sfVideoContinuousPlaytimeSeconds",i3=e=>{var t,i;let a=0;return t=e.div,i=e=>{a=e.detail.sfVideoContinuousPlaytimeSeconds},t.addEventListener(i2,e=>{i(e)}),{shouldFirePixel:()=>a>=2}},i9=async(e,t,i,a)=>{let n=tD(e);await tx(e.firePixelsAfter,n),await t_(e);let r=ae(e),s={id:e.placementId,name:e.placementName,div:n,deviceType:e.deviceType};iP(r).fire(s),i1(e);let{amznViewPixel:l,iabViewPixel:o,groupmViewPixel:d}=i5(r,e,s);o.isBtr=a.isBtr,o.track(s),c().isT1()||(l.track(s),d.track(s))},i5=(e,t,i)=>({amznViewPixel:iT(e),iabViewPixel:iC(t.mediaType,i.div,e,t.deviceType,i6(t.mediaType,i)),groupmViewPixel:iR(e)}),i6=(e,t)=>h(e)?i3(t):void 0,i4=new Set;class i8{constructor(e,t){this.hms=e,this.hc=t,this.expandInlineListeners=new Map,this.changeSize=iQ,this.fireImpressionWithDelay=async e=>{await tL(this.hms,e)},this.logAPIInvocation=(e,t)=>{let i=`messenger:${t.apiName}`;$(i),B(i,{id:e.placementId,name:e.placementName})},this.logError=iZ,this.logFatal=ij,this.logBlankAd=iX,this.logCsaEvent=i0,this.sendLatencyMetric=(e,t)=>i7(e,t),this.fireViewableLatencyMetrics=async(e,t)=>{tk(this.hc.viewableLatencyTrackers,e.arid,e.placementName,e.placementId,e.adUnitPlacementId,t.adLoadedTimestamp)},this.countMetric=(e,t)=>{t.isGlobal?$(t.metricMsg,t.value):B(t.metricMsg,{id:e.placementId,name:e.placementName},t.value)},this.requestVideoAutoplay=(e,t)=>{$("common:supported:command:requestVideoAutoplay"),tB(e,t,this.hms)},this.releaseVideoAutoplay=()=>{$("common:supported:command:releaseVideoAutoplay"),t$()},this.haveVideoAutoplayPermission=e=>{$("common:supported:command:haveVideoAutoplayPermission"),tW(e)},this.feedbackLabelRendered=e=>{eT(e)},this.feedbackOpenModal=e=>{eC(e)},this.collapseSlot=(e,t)=>{var i,a;if(null==(i=window.APE_SF)?void 0:i.collapsedPlacements.has(e.adUnitPlacementId))return void S("Slot already collapsed");eZ(e).collapse(e,t),null==(a=window.APE_SF)||a.collapsedPlacements.add(e.adUnitPlacementId)},this.sendEventAddedCreative=async e=>{i4.has(e.placementId)||(e.firePixelsAfter&&await tx(e.firePixelsAfter,tD(e)),await t_(e),iS(ae(e)).fire({id:e.placementId,name:e.placementName,div:tD(e),deviceType:e.deviceType}),i4.add(e.placementId))},this.sendEventCreativeBeginToRender=iG,this.sendEventCreativeLoaded=async(e,t)=>{await i9(e,this.hms,this.hc,t)},this.resizeForImageOnlyTemplate=e=>{eZ(e,!0).resize(e.size)},this.sendSfVideoContinuousPlaytimeSeconds=(e,t)=>{let i=tD(e),a=new CustomEvent(i2,{detail:t});i.dispatchEvent(a)},this.expandInline=e=>{if(!d().isT1()&&!d().isT2())return;let t=tD(e);if(!t)return;let i=this.expandInlineListeners.get(e.adUnitPlacementId);i&&i.forEach(({type:e,callback:t})=>{window.removeEventListener(e,t)});let a=eG(e.slotName)?"312px":"307px";t.style.transition="height 0.3s ease",t.style.setProperty("height",eG(e.slotName)?a:e_(a),"important");let n=t=>{this.hms.sendMessageToAd(e.arid,"triggerEventInIframe",{eventType:t.type}),this.resetSlot(e)},r=["scroll","click","swipe","tap"].map(e=>({type:e,callback:n}));r.forEach(({type:e,callback:t})=>{window.addEventListener(e,t,{once:!0})}),this.expandInlineListeners.set(e.adUnitPlacementId,r)},this.resetSlot=e=>{if(!d().isT1()&&!d().isT2())return;let t=tD(e);t&&(t.style.transition="height 0.3s ease",t.style.setProperty("height",eG(e.slotName)?e.size.height:e_(e.size.height),"important"))}}}let i7=(e,{latencyMetricType:t,timestamp:i})=>{ts().sendLatencyMetric({latencyMetricType:t,placementName:e.placementName,placementId:e.placementId,placementDivId:e.adUnitPlacementId,timestamp:i})},ae=e=>{var t;return{aaxImpPixelUrl:e.aaxImpPixelUrl,aaxInstrPixelUrl:e.aaxInstrPixelUrl,abpAcceptable:e.abpAcceptable,abpStatus:null!=(t=e.abpStatus)?t:"-1",btrPixelUrl:e.btrPixelUrl,skAdNetwork:e.skAdNetwork,loggingContext:{aaxProgramId:Number(e.adCreativeMetaData.adProgramId)}}},at="nav-cart",ai=e=>{let t=document.documentElement,i=tD(e);aa(t,i),new MutationObserver(e=>{for(let t of e)"attributes"===t.type&&"class"===t.attributeName&&aa(t.target,i)}).observe(t,{attributes:!0,attributeFilter:["class"]})},aa=(e,t)=>{if(e.classList.contains("nav-ewc-persistent-hover")){t.classList.add(at);let e=an();t.style.setProperty("--nav-cart-full-width",`${e}px`),t.style.setProperty("--nav-cart-half-width",`${e/2}px`)}else t.classList.remove(at)},an=()=>{var e;let t=document.querySelector("div#nav-flyout-ewc");return null!=(e=null==t?void 0:t.offsetWidth)?e:0},ar=Array.from({length:100},(e,t)=>(t+1)/100),as=(e,t)=>{let i=tN(e);i&&new IntersectionObserver(i=>i.forEach(i=>al(e,t,i)),{threshold:ar}).observe(i)},al=(e,t,{target:i,intersectionRect:a,boundingClientRect:n,intersectionRatio:r})=>{let s=a.width/n.width,l=a.height/n.height;t.sendMessageToAd(e.arid,"populateSafeFrameExt",{geom:{self:{t:n.top,l:n.left,r:n.right,b:n.bottom,xiv:s,yiv:l,iv:r,z:1,w:i.offsetWidth,h:i.offsetHeight}},inViewPercentage:Math.round(100*r)})},ao=(e,t)=>{setInterval(()=>{let i=tN(e);if(!i)return;let a=i.getBoundingClientRect();t.sendMessageToAd(e.arid,"populateGeom",{geom:{self:{t:a.top,l:a.left,r:a.right,b:a.bottom,z:1,w:i.offsetWidth,h:i.offsetHeight}}})},250)},ad="adplacements:retailClickTracking:failure",ac=async e=>{let t=document.getElementById(e);null==t||t.removeAttribute("onclick");let i=null==t?void 0:t.getAttribute("data-click-addr");if(!i)return void window.ue.count("adplacements:retailClickTracking:missingUrl",1);try{(await fetch(i,{keepalive:!0})).ok?window.ue.count("adplacements:retailClickTracking:clickSuccess",1):window.ue.count(ad,1)}catch(e){window.ue.count(ad,1)}},am=e=>({onSafeFrameReady(t){var i,a;ah("eventsChannel:onSafeFrameReady",t),null==(a=performance)||null==(i=a.mark)||i.call(a,`SafeFrame:  safeFrameReady ${t.slotName}`),e.sendMessageToAd(t.arid,"setupComputedAdDetails",{aPageStart:window.aPageStart,adStartTime:new Date().getTime()}),window.addEventListener("resize",()=>{e.sendCustomMessageToAd(t.arid,"resize",{height:window.innerHeight,width:window.innerWidth})}),iH(t),ai(t),as(t,e),ao(t,e)},onPreCreativeWrite(e){ah("eventsChannel:onPreCreativeWrite",e);let t={id:e.placementId,name:e.placementName};B("adload:renderstart",t),Z("adload_renderstart",t)},onPostCreativeWrite(e){ah("eventsChannel:onPostCreativeWrite",e);let t={id:e.placementId,name:e.placementName};B("adload:renderend",t),Z("adload_renderend",t)},onCreativeBeginToRender(e){ah("eventsChannel:onCreativeBeginToRender",e)},onCreativeLoad(e){ah("eventsChannel:onCreativeLoad",e);let t={id:e.placementId,name:e.placementName};B("adload:creativewritten",t),Z("adload_creativewritten",t)},onError(e){ah("eventsChannel:onError",e)},onClick(e){ah("eventsChannel:onClick",e),ac(e.adUnitPlacementId)}}),ah=(e,t)=>{$(e),B(e,{id:t.placementId,name:t.placementName},performance.now())},au=()=>{let e=new k,t=new M(e.adMap),i=am(t),a=new N(new i8(t,e),i);return new tP(e,a)},ap=()=>{performance.mark("Safeframe: initSafeframeHostDesktop"),window.APE_SF||(performance.mark("Safeframe: initSafeframeHostDesktop init"),window.APE_SF=au())};m(()=>ap(),T,"Error initializing safeFrame")()})();
//# sourceMappingURL=DAsf-1.50.165eaeda.js.map
