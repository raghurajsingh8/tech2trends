var LoggingClientManager;(()=>{var e={39:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventType=void 0,t.EventType={error:0,0:"error",impression:1,1:"impression",performance:2,2:"performance",renderAnalysis:3,3:"renderAnalysis",interaction:4,4:"interaction",viewability:5,5:"viewability"}},72:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.VISUAL_COMPLETENESS_LATENCY=t.UNCAUGHT_ERROR=t.CREATIVE_LOAD_LATENCY=void 0;let i=t.UNCAUGHT_ERROR="uncaughtError";t.CREATIVE_LOAD_LATENCY="creativeLoadLatency",t.VISUAL_COMPLETENESS_LATENCY="visualCompletenessLatency",t.default=class{constructor(e){if(this.events={[i]:{}},this.timers={},this.onNewError=()=>{},this.window=e&&e.window||"undefined"!=typeof window&&window,!this.window||!this.window.document)throw new Error("Window and/or document is not defined");this.trackLoadLatency(),this.trackVisualCompletenessLatency(),this.addErrorListener()}trackLoadLatency(){this.timers.creativeLoadLatency=new Date}trackVisualCompletenessLatency(){this.timers.visualCompletenessLatency=new Date}addErrorListener(){let e=this.events[i];this.addListener(this.window,"error",t=>{let i=t.message;t.error&&t.error.stack&&(i=(t=t.message+" : "+t.error.stack).length<500?t:t.substring(0,500)),void 0===e[i]&&(e[i]=!0,this.onNewError(i))})}addListener(...e){let t=e[0],i=e[1],n=e[2],s=(e=window.event)=>n(e);if(t.addEventListener)t.addEventListener(i,s,!0);else{var r="on"+i;if(t.attachEvent)t.attachEvent(r,s);else{let i=t[r];t[r]=()=>{s.apply(this,...e),"function"==typeof i&&i.apply(this,...e)}}}}}},334:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderAnalysisEventSubType=t.ALLOWLISTED_TEMPLATES=t.ErrorType=t.EventType=void 0;let n=i(745),s=(Object.defineProperty(t,"ErrorType",{enumerable:!0,get:function(){return n.ErrorType}}),i(39)),r=(Object.defineProperty(t,"EventType",{enumerable:!0,get:function(){return s.EventType}}),i(644)),o=(Object.defineProperty(t,"RenderAnalysisEventSubType",{enumerable:!0,get:function(){return r.RenderAnalysisEventSubType}}),i(411));Object.defineProperty(t,"ALLOWLISTED_TEMPLATES",{enumerable:!0,get:function(){return o.ALLOWLISTED_TEMPLATES}})},389:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});let n=i(334);t.default=class{props;interactionListenerElement=void 0;interactionData={clickCount:0,hoverCount:0,hoverInMilliseconds:0};hoverTimeStart=0;constructor(e){this.props=e,this.interactionListenerElement=e.element,this.setupListenerForHovers()}createInteractionEvent(){if(this.getHoverTime(),0<this.interactionData.clickCount||0<this.interactionData.hoverCount||0<this.interactionData.hoverInMilliseconds)return{eventType:n.EventType.interaction,impressionId:this.props.impressionId,templateKey:this.props.templateKey,timestamp:(new Date).toISOString(),userAgent:this.props.userAgent,layoutId:this.props.layoutId,dimensions:{clicks:this.interactionData.clickCount,hovers:this.interactionData.hoverCount,timeInHoverMs:this.interactionData.hoverInMilliseconds}}}clearInteractionData(){this.interactionData={clickCount:0,hoverCount:0,hoverInMilliseconds:0}}setupListenerForHovers(){this.interactionListenerElement?.addEventListener("click",()=>{this.recordClick()}),this.interactionListenerElement?.addEventListener("mouseenter",()=>{this.hoverTimeStart=Date.now()}),this.interactionListenerElement?.addEventListener("mouseleave",()=>{this.getHoverTime()})}getHoverTime(){var e;0<this.hoverTimeStart&&(0<(e=Date.now()-this.hoverTimeStart)&&(this.recordHover(),this.recordTimeInHover(e)),this.hoverTimeStart=0)}recordClick(){var e=this.interactionData.clickCount;this.interactionData={clickCount:e+1,hoverCount:this.interactionData.hoverCount,hoverInMilliseconds:this.interactionData.hoverInMilliseconds}}recordHover(){var e=this.interactionData.hoverCount;this.interactionData={clickCount:this.interactionData.clickCount,hoverCount:e+1,hoverInMilliseconds:this.interactionData.hoverInMilliseconds}}recordTimeInHover(e){var t=this.interactionData.hoverInMilliseconds;this.interactionData={clickCount:this.interactionData.clickCount,hoverCount:this.interactionData.hoverCount,hoverInMilliseconds:t+e}}}},411:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ALLOWLISTED_TEMPLATES=void 0,t.ALLOWLISTED_TEMPLATES=["DACXDynamicTemplates-DynamicEcommerceTemplate_1.0","PERCTemplates-PERCTemplates_1.0","LEGACY_PERCTemplates-PERCTemplates_1.0"]},528:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});let n=i(334);t.default=class{props;initialViewability=null;maxViewability=0;timeInView={total:0,start:0};timeInImpression={total:0,start:0};boundingIframeSize=null;initialScrollDepth=null;constructor(e){var t=(this.props=e).element.getBoundingClientRect();this.getInitialBoundingIframeSize(t),this.getInitialScrollDepth(t),this.setUpIntersectionObserver(e.element)}getInitialBoundingIframeSize(e){var t=e.right-e.left;null===this.boundingIframeSize&&(this.boundingIframeSize=t+"x"+(e.bottom-e.top))}getInitialScrollDepth(e){var t=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight),i=window.innerHeight;e=window.pageYOffset+e.top;null===this.initialScrollDepth&&(this.initialScrollDepth=e/(t-i)*100)}setUpIntersectionObserver(e){new IntersectionObserver(e=>{e.forEach(e=>{e=Math.floor(100*e.intersectionRatio),null===this.initialViewability&&(this.initialViewability=e),this.maxViewability=Math.max(this.maxViewability,e),0<e&&this.startTimeInTimer(this.timeInView),e<=0&&this.recordTimeInTotal(this.timeInView),50<=e&&this.startTimeInTimer(this.timeInImpression),e<50&&this.recordTimeInTotal(this.timeInImpression)})},{threshold:Array.from({length:101},(e,t)=>t/100)}).observe(e)}startTimeInTimer(e){0===e.start&&(e.start=Date.now())}recordTimeInTotal(e){0!==e.start&&(e.total+=Date.now()-e.start,e.start=0)}createViewabilityEvent(){return this.recordTimeInTotal(this.timeInView),this.recordTimeInTotal(this.timeInImpression),{eventType:n.EventType.viewability,impressionId:this.props.impressionId,templateKey:this.props.templateKey,timestamp:(new Date).toISOString(),userAgent:this.props.userAgent,layoutId:this.props.layoutId||"default",size:this.props.size||"unknown",dimensions:{initialViewabilityPercentage:this.initialViewability||0,maximumViewabilityPercentage:this.maxViewability,timeInViewMs:this.timeInView.total,timeInImpressionMs:this.timeInImpression.total,boundingIframeSize:this.boundingIframeSize||"unknown",scrollDepth:this.initialScrollDepth??void 0}}}}},644:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderAnalysisEventSubType=void 0,t.RenderAnalysisEventSubType={acei:0,0:"acei",truncation:1,1:"truncation",bss:2,2:"bss"}},745:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorType=void 0,t.ErrorType={render:0,0:"render",layout:1,1:"layout",component:2,2:"component",misc:3,3:"misc",uncaught:4,4:"uncaught",buybox:5,5:"buybox"}},869:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SushiLogger=void 0,n=n(i(999));t.SushiLogger=n.default},925:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let i={beta:{na:"https://unagi-na.amazon.com/1/events/com.amazon.eel.D16GClientSideMetrics.nexus",eu:"https://unagi-na.amazon.com/1/events/com.amazon.eel.D16GClientSideMetrics.nexus",fe:"https://unagi-na.amazon.com/1/events/com.amazon.eel.D16GClientSideMetrics.nexus"},gamma:{na:"https://unagi-na.amazon.com/1/events/com.amazon.eel.pp.D16GClientSideMetrics.nexus",eu:"https://unagi-na.amazon.com/1/events/com.amazon.eel.pp.D16GClientSideMetrics.nexus",fe:"https://unagi-na.amazon.com/1/events/com.amazon.eel.pp.D16GClientSideMetrics.nexus"},prod:{na:"https://unagi-na.amazon.com/1/events/com.amazon.eel.p.D16GClientSideMetrics.nexus",eu:"https://unagi-eu.amazon.com/1/events/com.amazon.eel.p.D16GClientSideMetrics.nexus",fe:"https://unagi-fe.amazon.com/1/events/com.amazon.eel.p.D16GClientSideMetrics.nexus"}},n=i.beta.na;t.default=function(e,t){return e in i&&t in(e=i[e])?e[t]:n}},999:function(e,t,i){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let s=i(334),r=n(i(925)),o=n(i(528)),a=n(i(389));t.default=class{props;sushiEndpoint;events=[];hasSentInitialEvents=!1;interactionListener=null;viewabilityListener=null;constructor(e){this.props=e,this.sushiEndpoint=(0,r.default)(e.stage,e.region),this.prepareSendEvents()}setUpListener(e){e&&null===this.interactionListener&&(this.interactionListener=new a.default({...this.props,element:e}),this.viewabilityListener=new o.default({...this.props,element:e}))}prepareSendEvents(){"undefined"!=typeof document&&document?.addEventListener("visibilitychange",()=>{"hidden"===document?.visibilityState&&this.sendBeaconEvents()})}addEvent(e){this.events.push({data:e})}getSushiFormattedEvents(){return{events:this.events}}addErrorEvent(e,t){e={eventType:s.EventType.error,impressionId:this.props.impressionId,templateKey:this.props.templateKey,timestamp:(new Date).toISOString(),userAgent:this.props.userAgent,layoutId:this.props.layoutId||"default",size:this.props.size||"unknown",templateName:this.props.templateName||"none",dimensions:{errorType:e,message:t}},this.addEvent(e)}addImpressionEvent(e,t){e={eventType:s.EventType.impression,impressionId:this.props.impressionId,templateKey:this.props.templateKey,timestamp:(new Date).toISOString(),userAgent:this.props.userAgent,layoutId:this.props.layoutId||"default",size:this.props.size||"unknown",templateName:this.props.templateName||"none",dimensions:{is1p:e,domain:t}},this.addEvent(e)}addPerformanceEvent(e){e={eventType:s.EventType.performance,impressionId:this.props.impressionId,templateKey:this.props.templateKey,timestamp:(new Date).toISOString(),userAgent:this.props.userAgent,layoutId:this.props.layoutId||"default",size:this.props.size||"unknown",dimensions:{adLoadTimeMs:e}},this.addEvent(e)}addRenderAnalysisEvent(e,t){e={eventType:s.EventType.renderAnalysis,impressionId:this.props.impressionId,templateKey:this.props.templateKey,timestamp:(new Date).toISOString(),userAgent:this.props.userAgent,layoutId:this.props.layoutId||"default",size:this.props.size||"unknown",dimensions:{subType:e,payload:t}},this.addEvent(e)}async sendEvents(){if(0!==this.events.length){var e={body:JSON.stringify(this.getSushiFormattedEvents()),headers:{"Content-Type":"application/json"}};try{var t=await fetch(this.sushiEndpoint,{method:"POST",mode:"no-cors",...e});if(!t.ok)throw new Error("HTTP error status: "+t.status);this.clearEvents()}catch(e){throw console.error("Failed to send events:",e),e}}}sendBeaconEvents(){var e;!1===this.hasSentInitialEvents&&(this.hasSentInitialEvents=!0,(e=this.viewabilityListener?.createViewabilityEvent())&&this.addEvent(e),e=this.interactionListener?.createInteractionEvent())&&this.addEvent(e),0!==this.events.length&&(navigator.sendBeacon(this.sushiEndpoint,JSON.stringify(this.getSushiFormattedEvents()))?this.clearEvents():console.error("POST attempt failed: events not queued for transfer"))}clearEvents(){this.events=[],this.interactionListener?.clearInteractionData()}}}},t={};function i(n){var s=t[n];return void 0!==s||(s=t[n]={exports:{}},e[n].call(s.exports,s,s.exports,i)),s.exports}var n,s,r,o={};n=o,Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,s=i(869),r=i(72),n.default=class{constructor(e,t){var i;if(this.window=e.window||"undefined"!=typeof window&&window,!this.window||!this.window.document)throw new Error("Window and/or document is not defined");var n=null==(n=window)||null==(n=n.navigator)?void 0:n.userAgent;this.csmLogger=new s.SushiLogger({stage:e.stage,region:e.region,impressionId:e.impressionId,userAgent:n,templateKey:"LEGACY_PERCTemplates-PERCTemplates_1.0",templateName:e.templateName,layoutId:"default",size:e.size}),n=window.location!==window.parent.location?document.referrer:document.location.href;null!=(i=this.csmLogger)&&i.addImpressionEvent(e.is1p,n),this.performanceEventManager=t,this.addErrorListener()}addErrorListener(){var e,t=e=>{var t;null!=(t=this.csmLogger)&&t.addErrorEvent(4,e)};for(e in this.performanceEventManager.onNewError=t,this.performanceEventManager.events[r.UNCAUGHT_ERROR])t(e)}},LoggingClientManager=o})();